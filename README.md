# Markdown Content Generator Action

> A GitHub Action that detects MarkDown files in a given directory (and its sub-directories) and generate table of contents.

> Useful for repos that are used for note taking or contains lots of MarkDown files.

This GitHub Action is a by-product of Python package - **fmtree**. See [Pypi](https://pypi.org/project/fmtree/) for more
details.

## Instructions

Each directory with `.md-toc` directory will be scraped by a scraper.

Below is how the algorithm work, there are more details in later sections.

```
if .md-toc is empty:
    Scraper will scrape the File System and generate a Table of Content.
    A README.md will be generated with title being the directory name.
else:
    if README.template.md is present in .md-toc:
        write the MarkDown README with {{ content }} in it as a line, where the TOC will be
    if toc.py is present in .md-toc:
        this action will use this file to generate Table of Content
        Make sure TOC is output to stdout. Formatter and Sorter can be overwritten.
        Even Scraper can be overwritten but usually overwrite Sorter is enough.
    if generate_readme.py is present in .md-toc:
        this action will use this file to generate README.md by combining README.template.md with TOC generated by toc.py
```

## Overwrite `toc.py`

Please follow the following template

```python
import sys
import argparse
import pathlib2
from typing import List, Iterable

from fmtree.scraper import Scraper
from fmtree.filter import MarkdownFilter
from fmtree.format import GithubMarkdownContentFormatter
from fmtree import sorter
from fmtree.node import FileNode


class OSCPExerciseSorter(sorter.BaseSorter):
    def sorted(self, nodes: List[FileNode]) -> Iterable:
        # TODO: Write your implementation here
        return sorted(nodes, key=lambda node: node.get_filename())


if __name__ == '__main__':
    parser = argparse.ArgumentParser("md-toc parser")
    parser.add_argument("-i", "--input", required=True, help="input directory")
    args = parser.parse_args()
    # Write your custom implementation below
    scraper = Scraper(pathlib2.Path(args.input), scrape_now=False, keep_empty_dir=False, depth=4)
    scraper.add_filter(MarkdownFilter())  # TODO: Your Custom Filter, as many as you need
    scraper.run()
    sorter_ = OSCPExerciseSorter()  # TODO: Your Custom Sorter
    tree = sorter_(scraper.get_tree())

    # TODO: Custom Formatter, GithubMarkdownContentFormatter should be enough for GitHub
    formatter = GithubMarkdownContentFormatter(tree,
                                               no_readme_link=True,
                                               dir_link=True,
                                               full_dir_link=False,
                                               remove_md_ext=True,
                                               ignore_root_dir=True,
                                               link_dir_readme=True)
    stringio = formatter.generate()
    # custom implementation end here
    formatter.to_stream(sys.stdout)  # must output to stdout
```

It is used as

```bash
python toc.py --input <directory> > toc.txt
```

It takes in input directory and output in `stdout`.

You don't need to care about the `toc.txt`, it's just a intermediate file that will be used by `generate_readme.py`. If
you decide to overwrite `toc.py`, just make sure it has the `--input` argument and output the correct Table of Content
to `stdout`.

See [more samples](./sample.md) for more complete and complicated samples.

Get a copy of the [Template File](./toc-template.py).

`fmtree` used in the sample code is a python library for searching the file system for MarkDown files. See

- https://fmtree-dev.github.io/fmtree/ (Documentation)
- https://github.com/fmtree-dev/fmtree (Source Code)

for more details.

There are samples of how to create Custom `Sorter` and `Formatter`.

## Overwrite `generate_readme.py`

The original file is [generate_readme.py](generate_readme.py), you can make a new edition of it.

**In general, there is no need to overwrite this file, this simply combine `toc.txt` with `README.template.md`.**

It is used as

```bash
python generate_readme.py --input toc.txt --template_directory .md-toc 
```

If you want to customize this file, you don't need to worry about these arguments, just follow the template.

This file works the same way as `toc.py`, takes in an input file (toc.txt) and a directory containing
the `README.template.md`, and output a generated output of `README.md` to `stdout`.

If a `README.template.md` doesn't exist in `.md-toc`, `generate_readme.py` will output in this format

```
<Directory Name>
<TOC>
```

If a `README.template.md` does exist in `.md-toc`, `generate_readme.py` will output in the format you designed.

See [README.template.md](./README.template.md). The Table of Content will be placed at the location of `{{ TOC }}`.




